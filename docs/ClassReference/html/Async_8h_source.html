<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OpenRTM: Async.h ソースファイル</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- 作成： Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>メインページ</span></a></li>
      <li><a href="namespaces.html"><span>ネームスペース</span></a></li>
      <li><a href="annotated.html"><span>クラス</span></a></li>
      <li class="current"><a href="files.html"><span>ファイル</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>ファイル一覧</span></a></li>
      <li><a href="globals.html"><span>ファイルメンバ</span></a></li>
    </ul>
  </div>
<h1>Async.h</h1><a href="Async_8h.html">説明を見る。</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// -*- C++ -*-</span>
<a name="l00019"></a>00019 <span class="comment"></span><span class="preprocessor">#ifndef COIL_ASYNC_H</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#define COIL_ASYNC_H</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="Task_8h.html">coil/Task.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="Guard_8h.html" title="Guard template class.">coil/Guard.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">namespace </span>coil
<a name="l00027"></a>00027 {
<a name="l00041"></a><a class="code" href="classcoil_1_1Async.html">00041</a>   <span class="keyword">class </span><a class="code" href="classcoil_1_1Async.html" title="Async クラス.">Async</a>
<a name="l00042"></a>00042     : <span class="keyword">public</span> coil::<a class="code" href="classcoil_1_1Task.html" title="Task クラス.">Task</a>
<a name="l00043"></a>00043   {
<a name="l00044"></a>00044   <span class="keyword">public</span>:
<a name="l00060"></a><a class="code" href="classcoil_1_1Async.html#a91ae54f017184f8a59920f5264561072">00060</a>     <a class="code" href="classcoil_1_1Async.html#a91ae54f017184f8a59920f5264561072" title="コンストラクタ">Async</a>() {}
<a name="l00061"></a>00061 
<a name="l00077"></a><a class="code" href="classcoil_1_1Async.html#ac38f68a3d5cb896cc0ae40a1bdc5a5e6">00077</a>     <span class="keyword">virtual</span> <a class="code" href="classcoil_1_1Async.html#ac38f68a3d5cb896cc0ae40a1bdc5a5e6" title="デストラクタ">~Async</a>(){}
<a name="l00078"></a>00078 
<a name="l00094"></a>00094     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcoil_1_1Async.html#ada31d64682effe5daa79212d07c02b65" title="非同期実行用純粋仮想関数">invoke</a>() = 0;
<a name="l00095"></a>00095 
<a name="l00115"></a>00115     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classcoil_1_1Async.html#a791b91a66a98acec44e63b0c5fae8b20" title="完了状態チェック用純粋仮想関数">finished</a>() = 0;
<a name="l00116"></a>00116   };
<a name="l00117"></a>00117   
<a name="l00131"></a>00131   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Object, <span class="keyword">typename</span> Func&gt;
<a name="l00132"></a><a class="code" href="classcoil_1_1Async__t.html">00132</a>   <span class="keyword">class </span><a class="code" href="classcoil_1_1Async__t.html" title="Async_t テンプレートクラス.">Async_t</a>
<a name="l00133"></a>00133     : <span class="keyword">public</span> <a class="code" href="classcoil_1_1Async.html" title="Async クラス.">Async</a>
<a name="l00134"></a>00134   {
<a name="l00135"></a>00135   <span class="keyword">public</span>:
<a name="l00136"></a>00136 
<a name="l00160"></a><a class="code" href="classcoil_1_1Async__t.html#a164cb08198f5f690675e843d89677991">00160</a>     <a class="code" href="classcoil_1_1Async__t.html#a164cb08198f5f690675e843d89677991" title="コンストラクタ">Async_t</a>(Object* obj, Func func, <span class="keywordtype">bool</span> auto_delete = <span class="keyword">false</span>)
<a name="l00161"></a>00161       : m_obj(obj), m_func(func), m_finished(false), m_autodelete(auto_delete)
<a name="l00162"></a>00162     {
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164 
<a name="l00180"></a><a class="code" href="classcoil_1_1Async__t.html#afbda05450d027b0d0357283a264763c9">00180</a>     <span class="keyword">virtual</span> <a class="code" href="classcoil_1_1Async__t.html#afbda05450d027b0d0357283a264763c9" title="デストラクタ">~Async_t</a>()
<a name="l00181"></a>00181     {
<a name="l00182"></a>00182     }
<a name="l00183"></a>00183     
<a name="l00203"></a><a class="code" href="classcoil_1_1Async__t.html#a2a935cf066cd5b3a90feb0aa19b9a4b1">00203</a>     <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classcoil_1_1Async__t.html#a2a935cf066cd5b3a90feb0aa19b9a4b1" title="非同期処理用のスレッド実行関数">svc</a>()
<a name="l00204"></a>00204     {
<a name="l00205"></a>00205       m_func(m_obj);
<a name="l00206"></a>00206       {
<a name="l00207"></a>00207         <a class="code" href="classcoil_1_1Guard.html" title="Guard テンプレートクラス.">Guard&lt;Mutex&gt;</a> guard(m_mutex);
<a name="l00208"></a>00208         m_finished = <span class="keyword">true</span>;
<a name="l00209"></a>00209       }
<a name="l00210"></a>00210       
<a name="l00211"></a>00211       <span class="keywordflow">return</span> 0;
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213 
<a name="l00229"></a><a class="code" href="classcoil_1_1Async__t.html#aaffa0e7e46f8380b0e91e5177485e00d">00229</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcoil_1_1Async__t.html#aaffa0e7e46f8380b0e91e5177485e00d" title="非同期処理終了">finalize</a>()
<a name="l00230"></a>00230     {
<a name="l00231"></a>00231       <a class="code" href="classcoil_1_1Async__t.html#aaffa0e7e46f8380b0e91e5177485e00d" title="非同期処理終了">Task::finalize</a>();
<a name="l00232"></a>00232       <span class="keywordflow">if</span> (m_autodelete) <span class="keyword">delete</span> <span class="keyword">this</span>;
<a name="l00233"></a>00233     }
<a name="l00234"></a>00234 
<a name="l00250"></a><a class="code" href="classcoil_1_1Async__t.html#aa6b4d79bed3225128f3e5cbde7d0fef8">00250</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcoil_1_1Async__t.html#aa6b4d79bed3225128f3e5cbde7d0fef8" title="非同期処理活性化">invoke</a>()
<a name="l00251"></a>00251     {
<a name="l00252"></a>00252       <a class="code" href="classcoil_1_1Task.html#a812bc27f5acb67931a4c03c07c7aeb9e">activate</a>();
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254 
<a name="l00274"></a><a class="code" href="classcoil_1_1Async__t.html#af7c59952bc29131e36ee456d23bdf746">00274</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classcoil_1_1Async__t.html#af7c59952bc29131e36ee456d23bdf746" title="完了状態チェック">finished</a>()
<a name="l00275"></a>00275     {
<a name="l00276"></a>00276       <a class="code" href="classcoil_1_1Guard.html" title="Guard テンプレートクラス.">Guard&lt;Mutex&gt;</a> guard(m_mutex);
<a name="l00277"></a>00277       <span class="keywordflow">return</span> m_finished;
<a name="l00278"></a>00278     }
<a name="l00279"></a>00279   <span class="keyword">private</span>:
<a name="l00280"></a>00280     Object* m_obj;
<a name="l00281"></a>00281     Func m_func;
<a name="l00282"></a>00282     <span class="keywordtype">bool</span> m_finished;
<a name="l00283"></a>00283     <span class="keyword">const</span> <span class="keywordtype">bool</span> m_autodelete;
<a name="l00284"></a>00284     <a class="code" href="classcoil_1_1Mutex.html" title="Mutex クラス.">Mutex</a> m_mutex;
<a name="l00285"></a>00285   };
<a name="l00286"></a>00286   
<a name="l00300"></a>00300   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Object, <span class="keyword">typename</span> Func&gt;
<a name="l00301"></a><a class="code" href="classcoil_1_1Async__ref__t.html">00301</a>   <span class="keyword">class </span><a class="code" href="classcoil_1_1Async__ref__t.html" title="Async_ref_t テンプレートクラス.">Async_ref_t</a>
<a name="l00302"></a>00302     : <span class="keyword">public</span> <a class="code" href="classcoil_1_1Async.html" title="Async クラス.">Async</a>
<a name="l00303"></a>00303   {
<a name="l00304"></a>00304   <span class="keyword">public</span>:
<a name="l00305"></a>00305 
<a name="l00329"></a><a class="code" href="classcoil_1_1Async__ref__t.html#a9c9e02a04d699dbd488653a633f20383">00329</a>     <a class="code" href="classcoil_1_1Async__ref__t.html#a9c9e02a04d699dbd488653a633f20383" title="コンストラクタ">Async_ref_t</a>(Object* obj, Func&amp; func, <span class="keywordtype">bool</span> auto_delete = <span class="keyword">false</span>)
<a name="l00330"></a>00330       : m_obj(obj), m_func(func), m_finished(false), m_autodelete(auto_delete)
<a name="l00331"></a>00331     {
<a name="l00332"></a>00332     }
<a name="l00333"></a>00333 
<a name="l00349"></a><a class="code" href="classcoil_1_1Async__ref__t.html#aae2afa89f0a4f9c59db0a630d792751c">00349</a>     <span class="keyword">virtual</span> <a class="code" href="classcoil_1_1Async__ref__t.html#aae2afa89f0a4f9c59db0a630d792751c" title="デストラクタ">~Async_ref_t</a>()
<a name="l00350"></a>00350     {
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352     
<a name="l00372"></a><a class="code" href="classcoil_1_1Async__ref__t.html#a0faaac2e307957306e4a5f093aa39d26">00372</a>     <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classcoil_1_1Async__ref__t.html#a0faaac2e307957306e4a5f093aa39d26" title="非同期処理用のスレッド実行関数">svc</a>()
<a name="l00373"></a>00373     {
<a name="l00374"></a>00374       m_func(m_obj);
<a name="l00375"></a>00375       m_finished = <span class="keyword">true</span>;
<a name="l00376"></a>00376       <span class="keywordflow">return</span> 0;
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378 
<a name="l00394"></a><a class="code" href="classcoil_1_1Async__ref__t.html#a6be7d1b1d810323d89e8bf9c00f5874a">00394</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcoil_1_1Async__ref__t.html#a6be7d1b1d810323d89e8bf9c00f5874a" title="非同期処理活性化">invoke</a>()
<a name="l00395"></a>00395     {
<a name="l00396"></a>00396       <a class="code" href="classcoil_1_1Task.html#a812bc27f5acb67931a4c03c07c7aeb9e">activate</a>();
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398 
<a name="l00418"></a><a class="code" href="classcoil_1_1Async__ref__t.html#a9f47a1903293a0f6f53041f42b30368b">00418</a>     <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classcoil_1_1Async__ref__t.html#a9f47a1903293a0f6f53041f42b30368b" title="完了状態チェック">finished</a>()
<a name="l00419"></a>00419     {
<a name="l00420"></a>00420       <span class="keywordflow">return</span> m_finished;
<a name="l00421"></a>00421     }
<a name="l00422"></a>00422 
<a name="l00438"></a><a class="code" href="classcoil_1_1Async__ref__t.html#a3aa9d20e422e78db584ead57a50200da">00438</a>     <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcoil_1_1Async__ref__t.html#a3aa9d20e422e78db584ead57a50200da" title="非同期処理終了">finalize</a>()
<a name="l00439"></a>00439     {
<a name="l00440"></a>00440       <a class="code" href="classcoil_1_1Async__ref__t.html#a3aa9d20e422e78db584ead57a50200da" title="非同期処理終了">Task::finalize</a>();
<a name="l00441"></a>00441       <span class="keywordflow">if</span> (m_autodelete) <span class="keyword">delete</span> <span class="keyword">this</span>;
<a name="l00442"></a>00442     }
<a name="l00443"></a>00443   <span class="keyword">private</span>:
<a name="l00444"></a>00444     Object* m_obj;
<a name="l00445"></a>00445     Func&amp; m_func;
<a name="l00446"></a>00446     <span class="keywordtype">bool</span> m_finished;
<a name="l00447"></a>00447     <span class="keywordtype">bool</span> m_autodelete;
<a name="l00448"></a>00448     
<a name="l00449"></a>00449   };
<a name="l00450"></a>00450   
<a name="l00548"></a>00548   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Object, <span class="keyword">typename</span> Func&gt;
<a name="l00549"></a>00549   <span class="keyword">inline</span> Async_t&lt;Object, Func&gt;*
<a name="l00550"></a><a class="code" href="namespacecoil.html#af871c8ea1919908ab5dd7c84897e7b3e">00550</a>   <a class="code" href="namespacecoil.html#af871c8ea1919908ab5dd7c84897e7b3e" title="非同期メンバー関数呼び出しヘルパー関数">AsyncInvoker</a>(Object* obj, Func func, <span class="keywordtype">bool</span> auto_delete = <span class="keyword">false</span>)
<a name="l00551"></a>00551   {
<a name="l00552"></a>00552     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classcoil_1_1Async__t.html" title="Async_t テンプレートクラス.">Async_t&lt;Object, Func&gt;</a>(obj, func, auto_delete);
<a name="l00553"></a>00553   }
<a name="l00554"></a>00554 
<a name="l00582"></a>00582   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> Object, <span class="keyword">typename</span> Func&gt;
<a name="l00583"></a>00583   <span class="keyword">inline</span> Async_ref_t&lt;Object, Func&gt;*
<a name="l00584"></a><a class="code" href="namespacecoil.html#a6a774d2568d53f800d0504d64cde1f4d">00584</a>   <a class="code" href="namespacecoil.html#af871c8ea1919908ab5dd7c84897e7b3e" title="非同期メンバー関数呼び出しヘルパー関数">AsyncInvoker</a>(Object* obj, Func* func, <span class="keywordtype">bool</span> auto_delete = <span class="keyword">false</span>)
<a name="l00585"></a>00585   {
<a name="l00586"></a>00586     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classcoil_1_1Async__ref__t.html" title="Async_ref_t テンプレートクラス.">Async_ref_t&lt;Object, Func&gt;</a>(obj, *func, auto_delete);
<a name="l00587"></a>00587   }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 };
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 <span class="preprocessor">#endif // COIL_ASYNC_H</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>OpenRTMに対してThu May 24 23:25:18 2012に生成されました。&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
